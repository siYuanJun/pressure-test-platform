# 网站压测工具操作指南

## 1. 工具介绍

本工具用于对网站进行内外网压力测试，支持多目标、多并发测试，并能生成详细的性能报告。主要功能包括：
- 内网/外网独立压测
- 多URL同时测试
- 不同并发级别测试
- 性能数据收集与分析
- 自动生成对比报告
- 502错误监控

## 2. 环境准备

### 2.1 依赖要求
- macOS 或 Linux 系统
- bash 环境
- wrk 压测工具（本工具已集成）
- 足够的系统资源（建议至少4核CPU，8GB内存）

### 2.2 安装步骤
1. 克隆或下载本项目到本地
2. 进入项目目录：`cd /pressure-test-platform`
3. 赋予脚本执行权限：`chmod +x *.sh lib/*.sh`

## 3. 配置说明

### 3.1 配置文件位置
配置文件位于：`config.sh`

### 3.2 关键配置项

#### 3.2.1 内网测试目标
```bash
INTRANET_TARGETS=(
  "首页,https://www.example.com/zh/"
)
```

#### 3.2.2 外网测试目标
```bash
INTERNET_TARGETS=(
  "首页,https://www.example.com/zh/"
)
```

#### 3.2.3 压测参数
```bash
# 线程数（模拟用户数）
THREADS=10

# 并发连接数列表
CONNECTIONS_LIST=(50 100)

# 每个测试的持续时间
DURATION="5s"
```

### 3.3 配置修改方法
使用任意文本编辑器打开 `config.sh` 文件进行修改，保存后即可生效。

## 4. 使用方法

### 4.1 启动工具
在项目目录下执行：
```bash
./start.sh
```

### 4.2 主菜单选项
启动后会显示以下菜单：
```
===================================
        网站压测工具 v1.0
===================================

请选择要执行的操作:
1. 内网压测
2. 外网压测
3. 内网压测报告
4. 外网压测报告
5. 内外网对比报告
6. WAF性能报告
7. 手动收集测试数据
8. 清理测试数据
9. 退出
```

### 4.3 执行压测

#### 4.3.1 内网压测
1. 选择菜单选项 1
2. 在子菜单中选择 1 执行所有目标压测
3. 压测完成后自动生成数据文件

#### 4.3.2 外网压测
1. 选择菜单选项 2
2. 在子菜单中选择 1 执行所有目标压测
3. 压测完成后自动生成数据文件

### 4.4 生成报告

#### 4.4.1 内网报告
1. 选择菜单选项 3
2. 查看生成的报告内容

#### 4.4.2 外网报告
1. 选择菜单选项 4
2. 查看生成的报告内容

#### 4.4.3 内外网对比报告
1. 选择菜单选项 5
2. 查看生成的对比报告

## 5. 压测数据说明

### 5.1 数据文件位置
压测数据保存在项目目录下的 `data/` 文件夹中。

### 5.2 关键指标解读
- **QPS**：每秒查询数，越高越好
- **Latency**：响应时间，越低越好
- **Errors**：错误数，包括502错误等
- **CPU/Memory**：资源使用情况（仅内网测试）

## 6. 针对502错误的专项测试

### 6.1 步骤
1. 确保 config.sh 中配置了正确的外网URL
2. 执行外网压测（菜单选项 2）
3. 观察压测过程中的错误输出
4. 查看生成的报告中的错误统计

### 6.2 502错误分析重点
- 记录出现502错误的并发级别
- 分析不同URL的错误率差异
- 对比内网测试结果，确定问题是否为外网特有

## 7. 常见问题处理

### 7.1 无法连接到目标网站
- 检查网络连接
- 验证URL格式是否正确
- 确认目标网站是否可正常访问

### 7.2 压测过程中脚本崩溃
- 检查系统资源是否充足
- 降低 THREADS 和 CONNECTIONS_LIST 参数

### 7.3 生成报告失败
- 确认压测数据文件是否存在
- 检查数据文件格式是否正确

### 7.4 502错误监控
- 压测过程中会自动记录502错误
- 可在报告中查看502错误的统计信息

## 8. 注意事项

1. 压测前请确保已通知相关人员
2. 外网压测请控制并发量，避免对生产环境造成过大影响
3. 测试时间建议选择在业务低峰期
4. 保存所有压测数据，便于后续分析
5. 如遇严重问题，请立即停止测试并恢复服务

## 9. 联系方式

如有任何问题，请联系技术支持团队。
