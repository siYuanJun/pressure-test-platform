
# AI 开发提示词（压测产品全栈开发）
你是一位具备企业级项目开发经验的全栈工程师，需严格按照以下目录规范、阶段要求开发压测产品，输出的代码需符合可维护性、可扩展性规范，每个阶段交付可直接运行的成果。

## 一、项目核心信息
### 1. 项目目标
开发一套Web压测平台，支持用户提交压测申请（含域名+备案信息），后台审核后执行压测，基于已有Bash脚本和Python报告生成代码自动生成多格式可视化报告，包含前后台分离的管理系统和用户前台。

### 2. 技术栈明细
- 前台（用户端）：Next.js + Ant Design（响应式UI）
- 后台（管理端）：React + Ant Design Pro（https://ant.design/）
- 接口层：FastAPI（Python 3.10+），需开启Swagger自动接口文档
- 压测引擎：基于用户已有Bash脚本改造（封装wrk工具，支持Linux/Mac系统）
- 报告生成：复用用户已有Python代码（集成文件/图片报告生成逻辑）
- 数据库：MySQL 8.0+
- 部署方式：Docker + Docker Compose

### 3. 统一目录规范（根目录为 pressure-test-platform）
```
pressure-test-platform/
├── databases_sql/          # 阶段一：数据库相关
├── backend_admin_python/   # 阶段二：FastAPI后端核心（集成已有Python报告代码）
├── backend_admin_wrk_bash/ # 阶段二：用户已有Bash脚本（需改造）
│   └── start.sh            # 用户已有压测脚本（核心改造文件）
├── frontend_admin_web/     # 阶段三：管理后台前端
├── frontend_client_web/    # 阶段四：用户前台
├── deploy_docs/            # 阶段五：部署相关
└── README.md               # 项目总说明
```

## 二、分阶段开发要求与产出
### 阶段一：需求梳理与环境搭建（输出至 databases_sql/ 目录）
#### 核心任务
1. 梳理完整功能清单（分用户前台/管理后台，含详细功能点）
   - 新增：用户前台仅支持压测申请提交（域名+备案信息），无直接发起压测权限
   - 新增：管理后台压测申请审核列表、审核状态流转、审核后触发压测
2. 设计MySQL数据库表结构（需考虑索引、外键、字段注释）
   - 必含表：用户表（users）、压测申请表（apply_tasks）、压测任务表（tasks）、压测结果表（results）、报告表（reports）
   - 新增字段：apply_tasks表需包含domain（域名）、record_info（备案信息）、audit_status（审核状态）、audit_user（审核人）、audit_time（审核时间）等字段
   - 字段需包含：状态字段、时间戳、关联外键、业务核心字段
3. 创建全项目骨架代码（按上述目录规范生成空项目结构，含基础配置文件）
4. 编写开发环境搭建文档（含依赖安装、环境变量配置、启动命令）

#### 交付产出（全部输出至 databases_sql/ 目录）
- `功能清单+流程图.md`：详细功能点说明 + Mermaid格式业务流程图（含申请-审核-压测-报告全流程）
- `schema.sql`：可直接执行的MySQL建表语句（含字段注释、索引、初始数据）
- `project_skeleton/`：按统一目录规范生成的空项目骨架
- `开发环境配置文档.md`：含Python/Node/MySQL安装、环境变量、启动步骤

---

### 阶段二：FastAPI接口与压测核心（输出至 backend_admin_python/、backend_admin_wrk_bash/ 目录）
#### 核心任务
1. FastAPI用户认证模块（JWT）
   - 实现登录/注册/刷新token接口
   - 权限控制：区分普通用户/管理员角色（普通用户仅可提交申请，管理员可审核/执行压测）
2. 压测申请与审核接口
   - 普通用户接口：提交压测申请（域名、备案信息）、查询申请状态
   - 管理员接口：查询申请列表、审核申请（通过/驳回，需记录审核意见）、审核通过后自动触发压测任务
3. 压测任务调度接口
   - 仅管理员可触发，接收参数：target_url（审核通过的域名）、concurrency（并发数）、duration（压测时长）、script_path（可选lua脚本）
   - 异步执行压测任务（避免接口阻塞），调用改造后的Bash脚本
   - 实时返回任务状态、终止/重试任务接口
4. 改造用户已有Bash脚本（核心重点）
   - 脚本路径：backend_admin_wrk_bash/start.sh
   - 改造要求：
     ① 接收FastAPI传递的参数（target_url、concurrency、duration）
     ② 执行压测后输出标准化JSON格式结果（含QPS、平均响应时间、P95延迟、错误率）
     ③ 脚本内已有文件报告生成逻辑需保留，生成路径需同步至FastAPI可读取的目录
     ④ 支持与Python接口的数据交互：压测日志、中间结果、最终报告路径实时回传给FastAPI
     ⑤ 兼容Linux/Mac系统，处理脚本执行权限、路径问题
5. Python报告生成模块（复用用户已有代码）
   - 集成用户已有Python代码，读取Bash脚本生成的基础文件，生成HTML（带图表）、Markdown格式报告及图片报告
   - 图表类型：响应时间分布、QPS趋势、错误率统计
   - 报告文件存储至指定目录，路径记录至数据库
   - 支持报告生成状态查询、文件下载接口

#### 交付产出
##### backend_admin_python/ 目录
- 完整FastAPI项目代码（含路由、模型、依赖、配置文件）
  - 目录结构：`app/`（核心代码）、`config/`（配置文件）、`tests/`（单元测试）、`report_module/`（集成用户已有Python报告代码）、`requirements.txt`（依赖清单）
- `swagger_api_docs.md`：导出Swagger接口文档（或提供在线访问地址）
- `单元测试脚本.py`：覆盖核心接口的测试用例（含申请-审核-压测全流程）
- `README.md`：后端启动、接口调用说明，含已有Python代码集成说明

##### backend_admin_wrk_bash/ 目录
- `start.sh`：改造后的可执行wrk封装脚本（保留原有核心逻辑，新增参数接收、JSON输出、数据交互逻辑，含详细注释）
- `script.lua`：示例wrk扩展脚本（可选）
- `脚本改造说明.md`：改造点说明、参数说明、执行示例、与Python接口交互逻辑说明
- `原有脚本备份/`：用户原始start.sh备份文件

---

### 阶段三：管理后台（Ant Design Pro）（输出至 frontend_admin_web/ 目录）
#### 核心任务
1. 用户管理模块
   - 功能：用户列表（分页/筛选）、新增/编辑/禁用用户、角色分配（普通/管理员）
   - 权限控制：仅管理员可访问
2. 压测申请审核模块（核心新增）
   - 功能：申请列表（按审核状态/提交时间筛选）、查看申请详情（域名+备案信息）、审核操作（通过/驳回，输入审核意见）、审核通过后一键触发压测
3. 任务管理模块
   - 功能：查看所有压测任务（按状态/时间筛选）、终止运行中任务、重试失败任务、查看压测日志
4. 报告管理模块
   - 功能：报告列表、在线预览（文件+图片）、下载（HTML/Markdown/图片）、删除无效报告
5. 前后台联调
   - 配置API代理对接FastAPI
   - 处理接口异常、加载状态、权限校验

#### 交付产出（frontend_admin_web/ 目录）
- 完整Ant Design Pro项目代码（含路由、组件、接口封装）
- `权限控制说明.md`：角色权限配置、路由守卫实现细节
- `联调测试记录.md`：接口联调清单、问题修复记录
- `package.json` + `README.md`：依赖清单、启动/打包命令

---

### 阶段四：前台用户系统（Next.js）（输出至 frontend_client_web/ 目录）
#### 核心任务
1. 基础页面
   - 登录/注册页面（对接FastAPI认证接口）
   - 压测申请页面（表单：域名输入、备案信息上传/填写、表单校验）
   - 申请记录列表页（仅展示当前用户申请，按审核状态筛选，查看审核意见）
   - 报告查看页（仅可查看自己申请且审核通过、已完成压测的报告，可视化图表展示）
   - “联系我们”页面（静态表单，可配置提交接口）
2. UI要求
   - 基于Ant Design实现响应式布局（适配PC/移动端）
   - 申请状态实时展示（待审核/审核通过/审核驳回/压测中/已完成）
   - 报告图表可视化（复用后端生成的图表/前端重新渲染）

#### 交付产出（frontend_client_web/ 目录）
- 完整Next.js项目代码（含页面、组件、接口封装、路由）
- `响应式UI适配说明.md`：适配方案、测试设备清单
- `package.json` + `README.md`：依赖清单、启动/打包命令

---

### 阶段五：系统集成与上线（输出至 deploy_docs/ 目录）
#### 核心任务
1. 全链路测试
   - 覆盖“用户提交申请→管理员审核→触发压测→生成报告→用户查看”完整流程
   - 测试多用户并发提交申请、批量审核、大代码量报告生成场景
   - 测试异常场景（如无效域名、备案信息缺失、压测中断）
2. 性能与安全优化
   - FastAPI接口性能优化（异步处理、连接池）
   - Bash脚本与Python接口交互的性能优化（大代码量场景）
   - 安全加固：接口参数校验、SQL注入防护、XSS防护、JWT密钥安全、备案信息脱敏存储
3. Docker容器化部署
   - 为前端/后端/数据库编写Dockerfile
   - 编写docker-compose.yml（一键启动所有服务，包含Bash脚本执行环境、Python报告生成依赖）
4. 编写部署文档（含环境要求、部署步骤、运维说明）

#### 交付产出（deploy_docs/ 目录）
- `Dockerfile.frontend-admin`：管理后台前端镜像构建文件
- `Dockerfile.frontend-client`：用户前台镜像构建文件
- `Dockerfile.backend`：FastAPI后端镜像构建文件（包含Bash脚本执行环境、Python报告依赖）
- `docker-compose.yml`：完整部署配置（含MySQL、Redis可选）
- `全链路测试报告.md`：测试用例、测试结果、问题修复记录
- `部署文档.md`：环境要求、部署步骤、启动/停止命令、常见问题排查（含大代码量场景运维说明）
- `安全优化说明.md`：优化点、防护措施说明

## 三、通用交付要求
1. 代码规范：
   - Python代码遵循PEP8规范，含函数/类注释，已有报告代码集成部分需保留原逻辑并补充注释
   - JavaScript/React代码遵循ESLint规范，组件需加注释
   - Bash脚本需添加详细注释，改造点标注清晰
   - 所有配置文件（如FastAPI的config.py、前端的.env）需区分开发/生产环境
2. 可运行性：
   - 每个阶段交付的代码需提供启动命令，可直接在Linux/Mac环境运行
   - 依赖清单（requirements.txt/package.json）需明确版本号，避免依赖冲突
   - 大代码量场景需做性能优化，提供运行资源建议
3. 文档要求：
   - 每个目录下必须包含README.md，说明目录功能、文件结构、使用方法
   - API接口文档需包含请求参数、响应格式、错误码说明
   - 补充《Bash脚本改造手册》《Python报告代码集成手册》，说明核心逻辑与交互方式
4. 兼容性：
   - Bash脚本需兼容Linux（CentOS/Ubuntu）和Mac OS
   - 前端页面需兼容Chrome/Firefox/Safari主流浏览器
